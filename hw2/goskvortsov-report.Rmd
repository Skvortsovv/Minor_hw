---
title: "Анализ стартапов и выбор своего проекта"
output: html_document
---
## Задача

На основе данных с сайта kickstarter постараться выяснить, какие параметры влияют на удачность или неудачность стартапа, показав это на:

* графиках
* статистических тестах

и с помощью этого выбрать одну из возможных инициатив, которая по нашим прогнозам окажется успешной.
Представим, что мы имеем свою команду разработчиков компьютерных игр, которые хотят реализовать одну из нескольких идей стартапов. В результате нашей работы мы должны выбрать, какой именно проект мы будем реализовывать (какой проект с помощью DecisionTree покажет нам наиболее уверенную успешность).

Загрузим все необходимые билиотеки и датасет kickstarter, который содержит информацию о различных проектах в 2017 году

```{r, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning=FALSE, echo = F)
library(readr)
library(dplyr)
library(lubridate)
library(ggplot2)
library(coin)
library(rpart)
kickstarter = read_csv("~/shared/minor2_2020/1-Intro/hw2/kickstarter.csv")
usd_goals = read_csv("~/shared/minor2_2020/1-Intro/hw2/usd_goals.csv")
```

Далее создадим новые переменные: dead_m и launch_m, которые будут содержать информацию о месяцах дедлайна краудфандинговой кампании и лаунча проекта соответственно. Эти переменные будут категориальными, так как месяца не интуресуют нас в их числовом формате.
Также создадим переменную time_diff, которая будет содержать информацию о разнице между датой лаунча проекта и датой дедлайна краудфандинговой кампании. На первый взгляд ясно, что такая переменная может быть полезной для поиска взаимосвязей с целевой переменной state, более формально мы докажем это далее.
Преобразуем все переменные в необходимый нам формат (charachter в factor) и удалим переменные, которые больше не смогут быть нам полезными (name - так как будет слишком сложно находить в них текстовые закономерности, deadline и launch - так как мы достали из них всю необходимую нам информацию).
Также объединим датасет kickstarter с usd_goals, что позвольит привести все цели по финансированию к единому формату валюты. Остальные переменные данного харакетристики удалим.

```{r}
df = inner_join(kickstarter, usd_goals, by='id')
df = df %>% mutate(dead_m = as.factor(month(deadline))) %>% mutate(launch_m = as.factor(month(launched)))
df$launched = date(df$launched)
df$time_diff = as.numeric(df$deadline - df$launched)

df$category = as.factor(df$category)
df$main_category = as.factor(df$main_category)
df$country = as.factor(df$country)
df$state = as.factor(df$state)
df = dplyr::select(df, -deadline, -launched, -name, -goal.x, -goal.y, -currency)
```

Посмотрим на нашу целевую переменную state. Выведем доли двух групп.

```{r}
prop.table(table(df$state))
```

Можем увидеть, что группы, поделенные по целевой переменной практически равны: их доли близки к 50%. Это позволяет нам применять метрику accuracy, так как наша выборка **не является несбалансированной**.

Теперь начнем поиск закономерностей внутри каждой переменной. Сначала проследим разницу среди непрерывных переменных с помощью перестановочного критерия, проанализируем переменную usd_goal_real на уровне значимости 0.05.
H0: успешные и неуспешные проекты имеют одинаковую среднюю финансовую цель.
H1: разница присутствует.

```{r}
independence_test(usd_goal_real ~ state, data = df)
ggplot() + geom_boxplot(data=df, aes(x=state, y=usd_goal_real)) + labs(title='Зависимость успешности от финансовых целей', y='Финансовые цели', x='Успех') + 
  scale_x_discrete(labels=c('Неуспешный', 'Успешный'))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
На боксплоте видно, что неуспешные проекты имеют **более объемные** финансовые цели, чем успешные. Перестановочный критерий доказал, что эта разница статистически значима.

Посмотрим на переменную time_diff.
H0: успешные и неуспешные проекты имеют одинаковую среднюю разницу во времени (дни) между лаунчем проекта и дедлайном краудфандинговой кампании.
H1: разница присутствует.

```{r}
independence_test(time_diff ~ state, data = df)
ggplot() + geom_boxplot(data=df, aes(x=state, y=time_diff)) + labs(title='Зависимость успешности от времени между дедлайном \nкраудфандинговой кампании и запуском проекта', y='Дни', x='Успех') + 
  scale_x_discrete(labels=c('Неуспешный', 'Успешный'))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
На боксплоте видно, что неуспешные проекты имеют **большую** разницу во времени между лаунчем проекта и дедлайном краудфандинговой кампании, чем успешные. Перестановочный критерий доказал, что эта разница статистически значима.

Посмотрим на переменную backers.
H0: успешные и неуспешные проекты имеют одинаковое среднее количество поклонников.
H1: разница присутствует.

```{r}
independence_test(backers ~ state, data = df)
ggplot() + geom_boxplot(data=df, aes(x=state, y=backers)) + labs(title='Зависимость успешности от количества поклонников проекта', y='Поклонники', x='Успех') + 
  scale_x_discrete(labels=c('Неуспешный', 'Успешный'))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
На боксплоте видно, что успешные проекты имеют **большее** количество поклонников, чем успешные. Перестановочный критерий доказал, что эта разница статистически значима.

Теперь, оценим все категориальные переменные. 
Начнем с category.
H0: соотношения подкатегорий успешных и неуспешных проектов одинаковы.
H1: разница присутствует.

```{r}
chisq.test(table(df$category, df$state))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
Из-за большого количества уникальных подкатегорий барчарт становится неинтрепретируемым (именно поэтому он не прикреплен), однако по нему все-таки можно проследить, что соотношения подкатегорий для успешных и неуспешных проектов **различаются**. Критерий Хи-квадрат доказал, что эта разница статистически значима.

Посмотрим на переменную main_category.
H0: соотношения главных категорий успешных и неуспешных проектов одинаковы.
H1: разница присутствует.

```{r}
chisq.test(table(df$main_category, df$state))
ggplot() + geom_bar(data=df, aes(x=main_category, fill=state)) + labs(title='Зависимость успешности от основной категории проекта', x='Категория', y='') + 
  scale_fill_discrete(name = "Успех", labels = c("Неуспешный", "Успешный")) + coord_flip()
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
Барчарт показывает, что соотношения главных категорий для успешных и неуспешных проектов **различаются**. Критерий Хи-квадрат доказал, что эта разница статистически значима.

Посмотрим на переменную country
H0: соотношения стран, в которых создаются успешные и неуспешные проекты, одинаковы.
H1: разница присутствует.

```{r}
chisq.test(table(df$country, df$state))
ggplot() + geom_bar(data=df, aes(x=country, fill=state)) + labs(title='Зависимость успешности от страны проекта', x='Страна', y='') + 
  scale_fill_discrete(name = "Успех", labels = c("Неуспешный", "Успешный")) + coord_flip()
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
Барчарт показывает, что соотношения стран для успешных и неуспешных проектов **различаются**. Критерий Хи-квадрат доказал, что эта разница статистически значима.

Посмотрим на переменную dead_m (месяц дедлайна краудфандинговой кампании)
H0: у успешных и неуспешных проектов соотношения месяцев дедлайна краудфандинговой кампании одинаковы.
H1: разница присутствует.

```{r}
chisq.test(table(df$dead_m, df$state))
ggplot() + geom_bar(data=df, aes(x=dead_m, fill=state)) + labs(title='Зависимость успешности от месяца дедлайна \nкраудфандинговой кампании', x='Месяц', y='') + 
  scale_fill_discrete(name = "Успех", labels = c("Неуспешный", "Успешный"))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
Барчарт показывает, что соотношения месяцев дедлайна краудфандинговой кампании для успешных и неуспешных проектов **различаются**. Критерий Хи-квадрат доказал, что эта разница статистически значима.

Посмотрим на переменную launch_m (месяц дедлайна краудфандинговой кампании)
H0: у успешных и неуспешных проектов соотношения месяцев запуска проекта одинаковы.
H1: разница присутствует.

```{r}
chisq.test(table(df$launch_m, df$state))
ggplot() + geom_bar(data=df, aes(x=launch_m, fill=state)) + labs(title='Зависимость успешности от месяца запуска проекта', x='Месяц', y='') + 
  scale_fill_discrete(name = "Успех", labels = c("Неуспешный", "Успешный"))
```

p-value меньше, чем 0.05. Мы отклоняем нулевую гипотезу в пользу альтернативы на уровне значимости 0.05.
Барчарт показывает, что соотношения месяцев запуска проекта для успешных и неуспешных проектов **различаются**. Критерий Хи-квадрат доказал, что эта разница статистически значима.

Теперь, проанализировав изначальный датасет, мы можем приступить к ответу на основной вопрос отчета.
Создадим синтетиечский датасет, включающий в себя 8 различных проектов. Все эти проекты будут создан в США (country = USA), главная категория - игры (main_category = Games), валюта финансирования - доллар США (currency = USD). Представим, что для всех этих проектов месяц дедлайна краудфандинговой кампании - январь (dead_m = 1), а месяц запуска проекта - март (launch_m = 3). У всех проектов будут разные значения goal, backers и time_diff: эти значения сгенерированы, как среднее значение плюс/минус случайное значение между нулем и одним стандартным отклонением. Представим, что такие значения являются нашими прогнозами о судьбе нашего проекта в будущем. Так же эти проекты различаются своей подкатегорией (представим, что наша команда разработчиков готовы выполнить проект любой подкатегории внутри основной категории Игры).

```{r}
df_games = df[df$main_category=='Games', ]
projects = data.frame(category=as.factor(unique(df_games$category)), main_category=as.factor(rep('Games', 8)),
                      backers=c(318, 1680, 1599, 1352, 1273, 207, 1473, 489) , country=as.factor(rep('US', 8)),
                      usd_goal_real=c(40396, 81614, 84670, 1946, 39202, 39033, 94446, 94446),
                      dead_m=as.factor(rep(3, 8)), launch_m=as.factor(rep(1, 8)), 
                      time_diff=c(47, 42, 31, 42, 56, 40, 44, 48))

df = df %>% as.data.frame(df) %>% dplyr::select(-id)
```

Датасет projects и будет тем датасетом, который содержит информацию о тех проектах, которые может реализовать наша команда разработчиков.

Теперь, все готово для построения дерева: все переменные датасета kickstarter готовы, наша "тестовая" выборка сгенерирована. Построим дерево и проделаем фит его параметра complexity. Выведем

```{r, results='hide'}
set.seed(123)
tree =  rpart(state ~ ., data = df, control=rpart.control(cp=0.0001))
depth = as.data.frame(printcp(tree)) %>% dplyr::select(xerror, CP) %>% filter(xerror == min(xerror))

best_tree = prune(tree, cp=depth$CP[1])
projects$class = predict(best_tree, newdata=projects, type='class')
projects$probs = as.data.frame(predict(best_tree, newdata=projects, type='prob'))$successful

best_project = projects %>% filter(class == 'successful') %>% arrange(-probs, usd_goal_real) %>% dplyr::select(category, usd_goal_real, backers)
best_project = best_project[1, ]
```
Категория проекта:
```{r}
print(as.character(best_project$category))
```

Прогноз требуемого финансирования проекта:
```{r}
print(best_project$usd_goal_real)
```

Прогноз числа поклонников проекта:

```{r}
print(best_project$backers)
```

**Ответ:**  Таким образом, мы выделили самый успешный проект из тех, которые мы можем реализовать. Это игра из категории "Playing Cards". Этот проект был выбран, так как по результатам предсказания нашего дерева, у нас больше всего вероятности, что данный проект относится к успешным. Также мы провели вторую сортировку по переменной goal: нам будет легче запустить тот проект, которой требует меньшего финансирования.


**Вывод:**  Подводя итоги работы, можно сказать, что в предложенном датасете kickstarter все переменные являются критериями отличия успешных проектов от неуспешных. Такое отличие является статистически значимым, что доказывается соотстветствующими статистическими тестами. 
Далее было осуществлено построение дерева решений, которое было направлено на созданный датасет с целью выделения успешности проекта для практиечкой цели: его запуска.
Говоря о реальных условиях, данный проект может не оказать желаемых результатов: предложенный датасет описывает проекты в общем виде и дает информацию 2017 года, которая может оказаться неактуальной. Также, точность модели предсказаний может оказаться неэффективной: хоть она и высоко интерпретируема, но такие модели как xgboost или catboost дали бы более высокую предсказательную точность.

### Дэшборд

Полученные выводы обобщены в виде дэшборда со следующими элементами 

**Элемент 1:** 
 - вид: график
 - обоснование: график показывает доли успешных и неуспешных проектов в датасете kickstarter. Таким образом, мы можем судить о сбалансированности нашей выборки.
 
**Элемент 2:** 
 - вид: число
 - обоснование: финансовая цель нашего проекта это необходимый параметр: именно он будет оценивать жизнеспособность нашего проекта. Именно это показывает его актуальность в дэшборде.
 
**Элемент 3:** 
 - вид: график
 - обоснование: график показывает вероятность того, что тот или иной проект будет успешен. Цветом выделен тот проект, который был выбран нами, как лучший. Такая визуализация позволяет сделать выбор наиболее быстро.
 
 
